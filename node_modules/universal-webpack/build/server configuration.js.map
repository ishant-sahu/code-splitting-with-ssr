{"version":3,"sources":["../source/server configuration.js"],"names":["server_configuration","is_external","dont_emit_file_loader","replace_style_loader","extract_package_name","webpack_configuration","settings","configuration","context","process","cwd","output_file_name","basename","server","output","extname","entry","input","target","node","__dirname","__filename","libraryTarget","filename","chunkFilename","pathinfo","path","resolve","dirname","devtool","externals","Array","isArray","push","request","callback","plugins","filter","plugin","constructor","optimize","CommonsChunkPlugin","error","HotModuleReplacementPlugin","concat","LimitChunkCountPlugin","maxChunks","package_name","validForNewPackages","alias","exclude_from_externals_extensions","load_external_module_file_extensions","loadExternalModuleFileExtensions","extension","slice","indexOf","exclude_from_externals","excludeFromExternals","exclusion_pattern","RegExp","test","Error","module","rules","rule","oneOf","subrule","_dont_emit_file_loader","file_loader","url_loader","inspect","loader","options","emitFile","css_loader","env","UNIVERSAL_WEBPACK_CSS_LOADER_V2","exportOnlyLocals","use","start_from","length","to"],"mappings":"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","file":"server configuration.js","sourcesContent":["import path from 'path'\r\nimport util from 'util'\r\nimport webpack from 'webpack'\r\nimport validate_npm_package_path from 'validate-npm-package-name'\r\n\r\nimport\r\n{\r\n\tclone,\r\n\tstarts_with,\r\n\tends_with\r\n}\r\nfrom './helpers'\r\n\r\nimport\r\n{\r\n\tfind_loader,\r\n\tget_style_rules,\r\n\tnormalize_configuration_rule_loaders\r\n}\r\nfrom './loaders'\r\n\r\n// Tunes the client-side Webpack configuration for server-side build\r\nexport default function server_configuration(webpack_configuration, settings)\r\n{\r\n\t// if (!webpack_configuration.context)\r\n\t// {\r\n\t// \tthrow new Error(`You must set \"context\" parameter in your Webpack configuration`)\r\n\t// }\r\n\r\n\tconst configuration = clone(webpack_configuration)\r\n\r\n\t// By default, Webpack sets `context` to `process.cwd()`\r\n\tconfiguration.context = configuration.context || process.cwd()\r\n\r\n\t// (without extension)\r\n\tconst output_file_name = path.basename(settings.server.output, path.extname(settings.server.output))\r\n\r\n\tconfiguration.entry =\r\n\t{\r\n\t\t[output_file_name]: settings.server.input\r\n\t}\r\n\r\n\t// https://webpack.github.io/docs/configuration.html#target\r\n\tconfiguration.target = 'node'\r\n\r\n\t// Tell Webpack to leave `__dirname` and `__filename` unchanged\r\n\t// https://github.com/webpack/webpack/issues/1599#issuecomment-186841345\r\n\tconfiguration.node = configuration.node || {};\r\n\tconfiguration.node.__dirname = false;\r\n\tconfiguration.node.__filename = false;\r\n\r\n\t// https://webpack.github.io/docs/configuration.html#output-librarytarget\r\n\tconfiguration.output.libraryTarget = 'commonjs2'\r\n\r\n\t// No need for browser cache management, so disable hashes in filenames\r\n\tconfiguration.output.filename = '[name].js'\r\n\tconfiguration.output.chunkFilename = '[name].js'\r\n\r\n\t// Include comments with information about the modules.\r\n\t// require(/* ./test */23).\r\n\t// What for is it here? I don't know. It's a copy & paste from the Webpack author's code.\r\n\tconfiguration.output.pathinfo = true\r\n\r\n\t// Output server bundle into its own directory\r\n\tconfiguration.output.path = path.resolve(configuration.context, path.dirname(settings.server.output))\r\n\r\n\t// Output \"*.map\" file for human-readable stack traces\r\n\tconfiguration.devtool = 'source-map'\r\n\r\n\t// https://webpack.github.io/docs/configuration.html#externals\r\n\t//\r\n\t// `externals` allows you to specify dependencies for your library\r\n\t// that are not resolved by webpack, but become dependencies of the output.\r\n\t// This means they are imported from the environment during runtime.\r\n\t//\r\n\t// So that Webpack doesn't bundle \"node_modules\" into server.js.\r\n\r\n\tconfiguration.externals = configuration.externals || []\r\n\r\n\tif (!Array.isArray(configuration.externals))\r\n\t{\r\n\t\tconfiguration.externals = [configuration.externals]\r\n\t}\r\n\r\n\tconfiguration.externals.push(function(context, request, callback)\r\n\t{\r\n\t\tif (is_external(request, configuration, settings))\r\n\t\t{\r\n\t\t\t// Resolve dependency as external\r\n\t\t\treturn callback(null, request)\r\n\t\t}\r\n\r\n\t\t// Resolve dependency as non-external\r\n\t\treturn callback()\r\n\t})\r\n\r\n\t// Normalize `modules.rules` loaders.\r\n\tnormalize_configuration_rule_loaders(configuration)\r\n\r\n\t// Replace `style-loader` and `css-loader` with `css-loader/locals`\r\n\t// since it's no web browser and no files will be emitted.\r\n\treplace_style_loader(configuration)\r\n\r\n\t// Add `emit: false` flag to `file-loader` and `url-loader`,\r\n\t// since there's no need out emit files on the server side\r\n\t// (can just use the assets emitted on client build\r\n\t//  since the filenames are the same)\r\n\tdont_emit_file_loader(configuration)\r\n\r\n\tconfiguration.plugins = configuration.plugins || []\r\n\r\n\t// Remove HotModuleReplacementPlugin and CommonsChunkPlugin\r\n\tconfiguration.plugins = configuration.plugins.filter(plugin =>\r\n\t{\r\n\t\ttry\r\n\t\t{\r\n\t\t\tif (plugin.constructor === webpack.optimize.CommonsChunkPlugin)\r\n\t\t\t{\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t}\r\n\t\tcatch (error)\r\n\t\t{\r\n\t\t\t// Webpack 4 throws `RemovedPluginError`.\r\n\t\t}\r\n\r\n\t\treturn plugin.constructor !== webpack.HotModuleReplacementPlugin\r\n\t})\r\n\r\n\t// Add a couple of utility plugins\r\n\tconfiguration.plugins = configuration.plugins.concat\r\n\t(\r\n\t\t// Resorted from using it here because\r\n\t\t// if the `build/server` folder is not there\r\n\t\t// when Nodemon starts then it simply won't detect\r\n\t\t// updates of the server-side bundle\r\n\t\t// and therefore won't restart on code changes.\r\n\t\t//\r\n\t\t// `build/server` folder needs to be present\r\n\t\t// by the time Nodemon starts,\r\n\t\t// and that's accomplished with a separate npm script.\r\n\r\n\t\t// // Cleans the output folder\r\n\t\t// new clean_plugin([path.dirname(settings.server.output)],\r\n\t\t// {\r\n\t\t// \troot: configuration.context\r\n\t\t// }),\r\n\r\n\t\t// Put the resulting Webpack compiled code into a sigle javascript file\r\n\t\t// (doesn't disable CommonsChunkPlugin)\r\n\t\tnew webpack.optimize.LimitChunkCountPlugin({ maxChunks: 1 })\r\n\t)\r\n\r\n\t// Done\r\n\treturn configuration\r\n}\r\n\r\n// Checks if a require()d dependency is external.\r\n// Could also use https://www.npmjs.com/package/webpack-node-externals.\r\n// Still the self-made alias-aware solution works ok.\r\nexport function is_external(request, webpack_configuration, settings)\r\n{\r\n\t// If someone finds a way to mark all assets (jpg, png, css, scss)\r\n\t// as not external then create a Pull Request on github.\r\n\t// Until then, all assets from `node_modules` have to be specified\r\n\t// inside `exclude_from_externals` configuration parameter.\r\n\r\n\t// Mark all files inside packages (e.g. `node_modules`) as external.\r\n\r\n\tconst package_name = extract_package_name(request)\r\n\r\n\t// Skip webpack loader specific require()d paths\r\n\t// https://webpack.github.io/docs/loaders.html\r\n\tif (starts_with(package_name, '!') || starts_with(package_name, '-!'))\r\n\t{\r\n\t\t// The dependency is not external\r\n\t\treturn false\r\n\t}\r\n\r\n\t// If it's not a module require call,\r\n\t// then resolve it as non-external.\r\n\t//\r\n\t// https://github.com/npm/validate-npm-package-name\r\n\t//\r\n\tif (!validate_npm_package_path(package_name).validForNewPackages)\r\n\t{\r\n\t\t// The dependency is not external\r\n\t\treturn false\r\n\t}\r\n\r\n\t// If any aliases are specified, then resolve those aliases as non-external\r\n\tif (webpack_configuration.resolve && webpack_configuration.resolve.alias)\r\n\t{\r\n\t\tfor (const alias of Object.keys(webpack_configuration.resolve.alias))\r\n\t\t{\r\n\t\t\t// if (request === key || starts_with(request, key + '/'))\r\n\t\t\tif (package_name === alias)\r\n\t\t\t{\r\n\t\t\t\t// The module is not external\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Allows camelCasing\r\n\tconst exclude_from_externals_extensions = settings.load_external_module_file_extensions || settings.loadExternalModuleFileExtensions ||\r\n\t[\r\n\t\t'css',\r\n\t\t'png',\r\n\t\t'jpg',\r\n\t\t'svg',\r\n\t\t'xml'\r\n\t]\r\n\r\n\t// Assets are being exluded from externals\r\n\t// because they need loaders in order to be `require()`d.\r\n\tconst extname = path.extname(request)\r\n\tif (extname)\r\n\t{\r\n\t\tconst extension = extname.slice(1)\r\n\r\n\t\tif (extension)\r\n\t\t{\r\n\t\t\tif (exclude_from_externals_extensions.indexOf(extension) >= 0)\r\n\t\t\t{\r\n\t\t\t\t// \"The module is not external\"\r\n\t\t\t\t// (which means \"load this module with a special loader\")\r\n\t\t\t\treturn false\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Allows camelCasing\r\n\tconst exclude_from_externals = settings.exclude_from_externals || settings.excludeFromExternals\r\n\r\n\t// Skip modules explicitly ignored by the user\r\n\tif (exclude_from_externals)\r\n\t{\r\n\t\tfor (const exclusion_pattern of exclude_from_externals)\r\n\t\t{\r\n\t\t\tif (typeof exclusion_pattern === 'string')\r\n\t\t\t{\r\n\t\t\t\tif (request === exclusion_pattern\r\n\t\t\t\t\t|| starts_with(request, exclusion_pattern + '/'))\r\n\t\t\t\t{\r\n\t\t\t\t\t// The module is not external\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse if (exclusion_pattern instanceof RegExp)\r\n\t\t\t{\r\n\t\t\t\tif (exclusion_pattern.test(request))\r\n\t\t\t\t{\r\n\t\t\t\t\t// The module is not external\r\n\t\t\t\t\treturn false\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse\r\n\t\t\t{\r\n\t\t\t\tthrow new Error(`Invalid exclusion pattern: ${exclusion_pattern}. Only strings and regular expressions are allowed.`)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// The module is external\r\n\treturn true\r\n}\r\n\r\n// Adds `emitFile: false` flag to `file-loader` and `url-loader`,\r\n// since there's no need out emit files on the server side\r\n// (can just use the assets emitted on client build\r\n//  since the filenames are the same)\r\nexport function dont_emit_file_loader(configuration)\r\n{\r\n\tfor (const rule of configuration.module.rules)\r\n\t{\r\n\t\tif (rule.oneOf)\r\n\t\t{\r\n\t\t\tfor (const subrule of rule.oneOf)\r\n\t\t\t{\r\n\t\t\t\t_dont_emit_file_loader(subrule)\r\n\t\t\t}\r\n\r\n\t\t\tcontinue\r\n\t\t}\r\n\r\n\t\t_dont_emit_file_loader(rule)\r\n\t}\r\n}\r\n\r\n// Adds `emitFile: false` flag to `file-loader` and `url-loader`,\r\n// since there's no need out emit files on the server side\r\n// (can just use the assets emitted on client build\r\n//  since the filenames are the same)\r\nfunction _dont_emit_file_loader(rule)\r\n{\r\n\tconst file_loader = find_loader(rule, 'file-loader')\r\n\tconst url_loader  = find_loader(rule, 'url-loader')\r\n\r\n\tif (file_loader && url_loader)\r\n\t{\r\n\t\tthrow new Error('You have both \"url-loader\" and \"file-loader\" defined for rule which makes no sense', util.inspect(rule))\r\n\t}\r\n\r\n\tconst loader = file_loader || url_loader\r\n\r\n\tif (loader)\r\n\t{\r\n\t\tloader.options =\r\n\t\t{\r\n\t\t\t...loader.options,\r\n\t\t\temitFile : false\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Replaces `style-loader` and `css-loader` with `css-loader/locals`\r\n// since it's no web browser and no files will be emitted.\r\nexport function replace_style_loader(configuration)\r\n{\r\n\tfor (const rule of get_style_rules(configuration))\r\n\t{\r\n\t\tconst css_loader = find_loader(rule, 'css-loader')\r\n\r\n\t\tif (css_loader)\r\n\t\t{\r\n\t\t\t// Replace `css-loader` with `css-loader/locals`.\r\n\t\t\t// Also there's a stupid difference between `css-loader@2` and `css-loader@1`:\r\n\t\t\t// https://github.com/catamphetamine/universal-webpack/issues/101\r\n\t\t\tif (process.env.UNIVERSAL_WEBPACK_CSS_LOADER_V2) {\r\n\t\t\t\tcss_loader.options = {\r\n\t\t\t\t\t...css_loader.options,\r\n\t\t\t\t\texportOnlyLocals: true\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcss_loader.loader = 'css-loader/locals'\r\n\t\t\t}\r\n\t\t\t// Drop `style-loader`.\r\n\t\t\trule.use = rule.use.filter((loader) => loader.loader !== 'style-loader')\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Extracts npm package name.\r\n// Correctly handles \"private\" npm packages like `@namespace/package`.\r\nexport function extract_package_name(path)\r\n{\r\n\tif (path.indexOf('/') === -1)\r\n\t{\r\n\t\treturn path\r\n\t}\r\n\r\n\t// For regular npm packages\r\n\tlet package_name = path.slice(0, path.indexOf('/'))\r\n\r\n\t// Handle \"private\" npm packages\r\n\tif (package_name[0] === '@')\r\n\t{\r\n\t\tconst start_from = package_name.length + '/'.length\r\n\t\tconst to = path.indexOf('/', start_from)\r\n\r\n\t\tif (to >= 0)\r\n\t\t{\r\n\t\t\tpackage_name += path.slice(start_from - '/'.length, to)\r\n\t\t}\r\n\t\telse\r\n\t\t{\r\n\t\t\tpackage_name = path\r\n\t\t}\r\n\t}\r\n\r\n\treturn package_name\r\n}"]}
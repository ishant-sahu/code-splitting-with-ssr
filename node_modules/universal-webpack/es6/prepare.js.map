{"version":3,"sources":["../source/prepare.js"],"names":["prepare","settings","project_base_path","base_path","process","cwd","server","output","Error","server_build_bundle_path","resolve","server_build_folder","dirname","normalize","indexOf","emptyDirSync"],"mappings":";;;;;kBAUwBA,O;;AAVxB;;;;AACA;;;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACe,SAASA,OAAT,CAAiBC,QAAjB,EAA2BC,iBAA3B,EACf;AACC;AACA,KAAMC,YAAYD,qBAAqBE,QAAQC,GAAR,EAAvC;;AAEA,KAAI,CAACJ,SAASK,MAAT,CAAgBC,MAArB,EACA;AACC,QAAM,IAAIC,KAAJ,CAAU,wCAAV,CAAN;AACA;;AAED,KAAMC,2BAA2B,eAAKC,OAAL,CAAaP,SAAb,EAAwBF,SAASK,MAAT,CAAgBC,MAAxC,CAAjC;AACA,KAAMI,sBAAsB,eAAKC,OAAL,CAAaH,wBAAb,CAA5B;;AAEA;AACA,KAAIE,wBAAwB,eAAKE,SAAL,CAAeV,SAAf,CAA5B,EACA;AACC,QAAM,IAAIK,KAAJ,CAAU,+BAA+BG,mBAA/B,GAAqD,gGAA/D,CAAN;AACA;;AAED;AACA,KAAIA,oBAAoBG,OAApB,CAA4BX,SAA5B,MAA2C,CAA/C,EACA;AACC,QAAM,IAAIK,KAAJ,CAAU,+BAA+BG,mBAA/B,GAAqD,+CAArD,GAAuGR,SAAvG,GAAmH,6DAA7H,CAAN;AACA;;AAED,mBAAGY,YAAH,CAAgBJ,mBAAhB;AACA","file":"prepare.js","sourcesContent":["import path from 'path'\r\nimport fs from 'fs-extra'\r\n\r\n// Creates (or cleans) the server-side build folder.\r\n//\r\n// That's needed because Nodemon, for example,\r\n// needs the folder to exist by the time it runs,\r\n// otherwise it won't detect any changes to the code\r\n// and therefore won't restart on code changes.\r\n//\r\nexport default function prepare(settings, project_base_path)\r\n{\r\n\t// By default, Webpack sets `.context` to `process.cwd()`\r\n\tconst base_path = project_base_path || process.cwd()\r\n\r\n\tif (!settings.server.output)\r\n\t{\r\n\t\tthrow new Error('`settings.server.output` not specified')\r\n\t}\r\n\r\n\tconst server_build_bundle_path = path.resolve(base_path, settings.server.output)\r\n\tconst server_build_folder = path.dirname(server_build_bundle_path)\r\n\r\n\t// Extra caution to prevent data loss\r\n\tif (server_build_folder === path.normalize(base_path))\r\n\t{\r\n\t\tthrow new Error('`settings.server.output` \"' + server_build_folder + '\" points to the project root folder. Won\\'t clear that folder to prevent accidental data loss.')\r\n\t}\r\n\r\n\t// Extra caution to prevent data loss\r\n\tif (server_build_folder.indexOf(base_path) !== 0)\r\n\t{\r\n\t\tthrow new Error('`settings.server.output` \"' + server_build_folder + '\" points outside of the project root folder \"' + base_path + '\". Won\\'t clear that folder to prevent accidental data loss')\r\n\t}\r\n\r\n\tfs.emptyDirSync(server_build_folder)\r\n}"]}
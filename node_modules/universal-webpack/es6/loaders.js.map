{"version":3,"sources":["../source/loaders.js"],"names":["get_style_rules","is_style_rule","parse_loader","stringify_loader","find_loader","normalize_configuration_rule_loaders","normalize_rule_loaders","configuration","module","rules","Error","style_rules","rule","oneOf","subrule","push","style_loader","extract_text_plugin_loader","use","filter","loader","test","name","options","parsed","query","parse","indexOf","substring","result","stringify","loader_name","_","inspect","loaders","split","parsed_loader","length","Array","isArray","map"],"mappings":"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","file":"loaders.js","sourcesContent":["import util from 'util'\r\nimport querystring from 'querystring'\r\n\r\nimport { is_object, ends_with } from './helpers'\r\n\r\n// https://webpack.js.org/configuration/module/\r\n\r\n// Finds module rules with `style-loader`.\r\n// If a rule has `oneOf` then a branch of `oneOf` is returned.\r\n//\r\n// `configuration` rule loaders must already be normalized.\r\n//\r\nexport function get_style_rules(configuration)\r\n{\r\n\t// Sanity check\r\n\tif (!configuration.module.rules)\r\n\t{\r\n\t\tthrow new Error('No `module.rules` found in Webpack configuration. Migrate your configuration to Webpack 2: https://webpack.js.org/guides/migrating/')\r\n\t}\r\n\r\n\tconst style_rules = []\r\n\r\n\tfor (const rule of configuration.module.rules)\r\n\t{\r\n\t\t// Recurse into `oneOf`.\r\n\t\t// https://webpack.js.org/configuration/module/#rule-oneof\r\n\t\tif (rule.oneOf)\r\n\t\t{\r\n\t\t\tfor (const subrule of rule.oneOf)\r\n\t\t\t{\r\n\t\t\t\tif (is_style_rule(subrule))\r\n\t\t\t\t{\r\n\t\t\t\t\tstyle_rules.push(subrule)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tcontinue\r\n\t\t}\r\n\r\n\t\tif (is_style_rule(rule))\r\n\t\t{\r\n\t\t\tstyle_rules.push(rule)\r\n\t\t}\r\n\t}\r\n\r\n\treturn style_rules\r\n}\r\n\r\n// `rule` must already be normalized\r\nexport function is_style_rule(rule)\r\n{\r\n\t// Check if this module loader has a `style-loader`\r\n\tconst style_loader = find_loader(rule, 'style-loader')\r\n\r\n\t// Is it `extract-text-webpack-plugin` loader\r\n\t// (the regular expression is a filesystem path\r\n\t//  which is `.../extract-text-webpack-plugin/loader.js` for v2\r\n\t//  and `.../extract-text-webpack-plugin/dist/loader.js` for v3)\r\n\tconst extract_text_plugin_loader = rule.use.filter((loader) => /extract-text-webpack-plugin/.test(loader.loader))[0]\r\n\r\n\treturn style_loader && !extract_text_plugin_loader\r\n}\r\n\r\n// Converts loader string into a Webpack 2 loader structure\r\nexport function parse_loader(loader)\r\n{\r\n\tlet name\r\n\tlet options\r\n\r\n\tif (is_object(loader))\r\n\t{\r\n\t\tif (!loader.loader)\r\n\t\t{\r\n\t\t\tthrow new Error(`.loader not set for a used loader`)\r\n\t\t}\r\n\r\n\t\tconst parsed = parse_loader(loader.loader)\r\n\r\n\t\tname = parsed.loader\r\n\t\toptions = parsed.options || (loader.query || loader.options)\r\n\r\n\t\tif (typeof options === 'string')\r\n\t\t{\r\n\t\t\toptions = querystring.parse(options)\r\n\t\t}\r\n\t}\r\n\telse\r\n\t{\r\n\t\tname = loader\r\n\r\n\t\tif (name.indexOf('?') >= 0)\r\n\t\t{\r\n\t\t\tname = name.substring(0, name.indexOf('?'))\r\n\t\t\toptions = querystring.parse(loader.substring(loader.indexOf('?') + 1))\r\n\t\t}\r\n\t}\r\n\r\n\tconst result =\r\n\t{\r\n\t\tloader: name\r\n\t}\r\n\r\n\tif (options)\r\n\t{\r\n\t\tresult.options = options\r\n\t}\r\n\r\n\treturn result\r\n}\r\n\r\n// Converts loader info into a string\r\nexport function stringify_loader(loader)\r\n{\r\n\treturn loader.loader + (loader.options ? '?' + querystring.stringify(loader.options) : '')\r\n}\r\n\r\n// Checks if the passed loader is `loader_name`.\r\nexport function find_loader(rule, loader_name)\r\n{\r\n\treturn rule.use.filter(_ => _.loader === loader_name)[0]\r\n}\r\n\r\n// Converts `loader` to `loaders`\r\nexport function normalize_configuration_rule_loaders(configuration)\r\n{\r\n\tfor (const rule of configuration.module.rules)\r\n\t{\r\n\t\tnormalize_rule_loaders(rule)\r\n\t}\r\n}\r\n\r\n// Converts `loader` to `loaders`\r\nexport function normalize_rule_loaders(rule)\r\n{\r\n\t// Recurse into `oneOf`.\r\n\t// https://webpack.js.org/configuration/module/#rule-oneof\r\n\tif (rule.oneOf)\r\n\t{\r\n\t\tfor (const subrule of rule.oneOf)\r\n\t\t{\r\n\t\t\tif (!subrule.use)\r\n\t\t\t{\r\n\t\t\t\tthrow new Error(`A \"oneOf\" subrule must have \"use\" property.`, util.inspect(subrule))\r\n\t\t\t}\r\n\r\n\t\t\tnormalize_rule_loaders(subrule)\r\n\t\t}\r\n\r\n\t\treturn\r\n\t}\r\n\r\n\t// Convert `loaders` to `use`\r\n\tif (rule.loaders)\r\n\t{\r\n\t\trule.use = rule.loaders\r\n\t\tdelete rule.loaders\r\n\t}\r\n\r\n\t// If a `loader` shorthand is used, convert it to `use`\r\n\tif (rule.loader)\r\n\t{\r\n\t\tlet loaders = rule.loader.split('!')\r\n\r\n\t\tif (rule.query || rule.options)\r\n\t\t{\r\n\t\t\tconst parsed_loader = parse_loader(loaders[0])\r\n\r\n\t\t\tif (loaders.length > 1 || parsed_loader.options)\r\n\t\t\t{\r\n\t\t\t\tthrow new Error(`You have both a compound \".loader\" and a \".query\" (or an \".options\") property set up directly inside a module rule: ${util.inspect(rule)}. Rewrite it either using \".loaders\" or \".use\".`)\r\n\t\t\t}\r\n\r\n\t\t\tloaders = [parsed_loader]\r\n\r\n\t\t\tparsed_loader.options = rule.query || rule.options\r\n\t\t\tdelete rule.query\r\n\t\t\tdelete rule.options\r\n\t\t}\r\n\r\n\t\trule.use = loaders\r\n\t\tdelete rule.loader\r\n\t}\r\n\r\n\tif (!rule.use)\r\n\t{\r\n\t\tthrow new Error(`Neither \"loaders\" nor \"loader\" nor \"use\" nor \"oneOf\" are present inside a module rule: ${util.inspect(rule)}`)\r\n\t}\r\n\r\n\tif (typeof rule.use === 'string')\r\n\t{\r\n\t\trule.use = [rule.use]\r\n\t}\r\n\r\n\tif (!Array.isArray(rule.use))\r\n\t{\r\n\t\tthrow new Error(`Invalid Webpack configuration: \"rule.use\" must be an array:\\n\\n${JSON.stringify(rule, null, 2)}\\n\\nSee https://webpack.js.org/configuration/module/#rule-use`)\r\n\t}\r\n\r\n\trule.use = rule.use.map(parse_loader)\r\n}"]}